---
title: Preserve code objects on stack for MAKE_FUNCTION
status: closed
priority: 2
issue-type: task
created-at: "\"2026-01-08T18:06:57.388220+02:00\""
closed-at: "2026-01-08T19:14:26.381363+02:00"
close-reason: completed
---

File: src/stack.zig:386-406, 193-200 - LOAD_CONST turns pyc.Object.code into a placeholder constant, so MAKE_FUNCTION can't access the code object. Add a StackValue variant for code objects (or a dedicated expr wrapper) and push it from LOAD_CONST when obj == .code/.code_ref. Update MAKE_FUNCTION to consume this value and defer to decompiler for nested functions.
