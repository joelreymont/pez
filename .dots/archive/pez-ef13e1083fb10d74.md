---
title: Model comprehension builders in stack sim
status: closed
priority: 1
issue-type: task
created-at: "\"2026-01-08T19:17:13.761991+02:00\""
closed-at: "2026-01-08T21:53:54.549351+02:00"
---

Files: src/stack.zig:412 (BUILD_LIST), src/stack.zig:446 (BUILD_SET), src/stack.zig:732 (BUILD_MAP), src/stack.zig:912 (LIST_APPEND/SET_ADD/MAP_ADD) - current comprehension ops discard values so comprehension structure is lost. Add a StackValue builder that retains list/set/dict and appended key/value exprs, and update BUILD_* to create builder plus LIST_APPEND/SET_ADD/MAP_ADD to mutate the builder instead of popping.
